<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>å®æ—¶æ¥æ”¶å†…å®¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <script src="{{ url_for('static', filename='js/socket.io.min.js') }}"></script>
    <style>
        body {
            background-color: #f4f6f9;
        }
        #output {
            min-height: 300px;
            white-space: pre-wrap;
            font-family: monospace;
        }
    </style>
</head>
<body>
<div class="container my-5">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">ğŸ“¥ å®æ—¶æ¥æ”¶æ‰‹æœºå‘é€å†…å®¹</h4>
        </div>
        <div class="card-body">
            <p class="text-muted">ä¿æŒæ­¤é¡µé¢æ‰“å¼€ä»¥æ¥æ”¶æ¥è‡ªæ‰‹æœºçš„æ–‡æœ¬æˆ–æ–‡ä»¶ä¿¡æ¯ã€‚</p>
            <div id="output" class="border rounded p-3 bg-light">
                <span class="text-muted">ç­‰å¾…æ¥æ”¶å†…å®¹ä¸­...</span>
            </div>
            <a id="downloadLink" class="btn btn-success mt-3 d-none" download>ç‚¹å‡»ä¸‹è½½æ–‡ä»¶</a>
        </div>
    </div>
</div>

{% if qr_data_uri %}
<div class="text-center my-3">
    <p class="text-muted">ğŸ“± è¯·ç”¨æ‰‹æœºè®¿é—®ä»¥ä¸‹äºŒç»´ç åœ°å€ï¼ˆæ³¨æ„ï¼Œç”µè„‘å’Œæ‰‹æœºå¿…é¡»åœ¨ä¸€ä¸ªç½‘ç»œä¸‹ï¼‰ï¼š</p>
    <img src="{{ qr_data_uri }}" alt="ç›‘å¬äºŒç»´ç " style="max-width: 80%; height: auto;">
    <p class="small text-muted">æ‰«ç åæ‰‹æœºå‘é€å®æ—¶æ¥æ”¶æ–‡æœ¬æˆ–æ–‡ä»¶</p>
</div>
{% endif %}


<script>
    const socket = io();
    const out = document.getElementById('output');
    const downloadLink = document.getElementById('downloadLink');

    socket.on('new_content', function(data) {
        if (data.text) {
            out.innerHTML = '<strong>ğŸ“„ æ–‡æœ¬å†…å®¹ï¼š</strong><br>' + data.text;
            downloadLink.classList.add('d-none');
        } else if (data.filename && data.file_url) {
            // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
            out.innerHTML = '<strong>ğŸ“ æ”¶åˆ°æ–‡ä»¶ï¼š</strong><br>' + data.filename;

            // åˆ›å»ºéšè—çš„iframeæˆ–ç›´æ¥è·³è½¬å®ç°è‡ªåŠ¨ä¸‹è½½
            const downloadFrame = document.createElement('iframe');
            downloadFrame.src = data.file_url;
            downloadFrame.style.display = 'none';
            document.body.appendChild(downloadFrame);

            // åŒæ—¶ä¿ç•™æ‰‹åŠ¨ä¸‹è½½é“¾æ¥
            downloadLink.href = data.file_url;
            downloadLink.download = data.filename;
            downloadLink.textContent = 'ğŸ“ ä¸‹è½½æ–‡ä»¶ï¼š' + data.filename;
            downloadLink.classList.remove('d-none');
        }
    });
</script>
</body>
</html>
